{"version":3,"file":"extension.js","mappings":"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","sources":[".././src/documentHelpers.ts",".././src/formatProvider.ts","../external commonjs \"vscode\"","../webpack/bootstrap",".././src/extension.ts"],"sourcesContent":["'use strict';\nimport * as vscode from 'vscode';\n\nexport function fullDocumentRange(document: vscode.TextDocument): vscode.Range {\n    const lastLineId = document.lineCount - 1;\n    return new vscode.Range(0, 0, lastLineId, document.lineAt(lastLineId).text.length);\n}\n\nexport function getIndentationStyle(options: vscode.FormattingOptions) {\n    let tc: string, td: number;\n    if (options.insertSpaces) {\n        tc = ' ';\n        td = options.tabSize;\n    }\n    else {\n        tc = '\\t';\n        td = 1;\n    }\n    const ts: number = options.tabSize;\n    return { tc, td, ts };\n}\n\nexport function getSelectedLines(document: vscode.TextDocument, range: vscode.Range): vscode.Range {\n    return new vscode.Range(document.lineAt(range.start.line).range.start, document.lineAt(range.end.line).range.end);\n}\n\nexport function getPreviousLineContaintingText(document: vscode.TextDocument, selectedLines: vscode.Range) {\n    if (selectedLines.start.line > 0) {\n        let priorLineNum: number = selectedLines.start.line;\n        let priorLine: vscode.TextLine = document.lineAt(--priorLineNum);\n        while (priorLine.text.trim() === '' && priorLineNum > 0) {\n            priorLine = document.lineAt(--priorLineNum);\n        }\n        return priorLine;\n    }\n}\n","'use strict';\nimport * as vscode from 'vscode';\n\nexport function escapeToQuotedTcl(input: string): string {\n    return input\n        .replace(/\\\\/g, '\\\\\\\\')\n        .replace(/\\$/g, '\\\\$')\n        .replace(/\\[/g, '\\\\[')\n        .replace(/\\]/g, '\\\\]')\n        .replace(/\"/g, '\\\\\"')\n        .replace(/\\t/g, '\\\\t')\n        .replace(/\\r/g, '\\\\r')\n        .replace(/\\n/g, '\\\\n')\n        .replace(/\\x0b/g, '\\\\v')\n        .replace(/\\x07/g, '\\\\a')\n        .replace(/\\x08/g, '\\\\b')\n        .replace(/\\x0c/g, '\\\\f')\n        ;\n}\n\nexport function guessPreIndentation(priorLine: vscode.TextLine, tabChar: string, tabDepth: number, tabSize: number) {\n    let whiteSpace: string = priorLine.text.substr(0, priorLine.firstNonWhitespaceCharacterIndex);\n    let preIndent = 0;\n    let preIndentRemainder = 0;\n    if (tabChar === ' ') {\n        preIndent = Math.floor(whiteSpace.replace(/\\t/g, ' '.repeat(tabSize)).length / tabSize) * tabDepth;\n        preIndentRemainder = whiteSpace.replace(/\\t/g, ' '.repeat(tabSize)).length % tabSize;\n    } else {\n        preIndent = whiteSpace.replace(new RegExp(' '.repeat(tabSize), 'g'), '\\t').length;\n    }\n    if (/^#/.test(priorLine.text.trim())) {\n        // do nothing\n    } else if (/\\{$/.test(priorLine.text.trim())) {\n        preIndent += tabDepth;\n    } else if (/\\{\\s*\\}$/.test(priorLine.text.trim())) {\n        // do nothing\n    } else if (/\\}$/.test(priorLine.text.trim()) && preIndent > 0) {\n        preIndent -= tabDepth;\n    }\n    return tabChar.repeat(preIndent) + ' '.repeat(preIndentRemainder);\n}\n\nexport function formatTcl(inputCode: string, preIndent: string = '', tabChar: string = ' ', tabDepth: number = 4): string {\n    let tabLevel = 0;\n    let out: string[] = [];\n    let continuation = false;\n    let uglyif2 = false;\n\n    inputCode.split('\\n').forEach(element => {\n        let line = element.trim();\n        if (line === '') {\n            out.push('');\n        } else if (/^#/.test(line)) {\n            out.push(preIndent + tabChar.repeat(tabLevel) + line);\n        } else if (/\\b\\{\\s*\\}$/.test(line)) {\n            out.push(preIndent + tabChar.repeat(tabLevel) + line);\n        } else if (/\\{$/.test(line) || /^\\{$/.test(line)) {\n            if (/^\\}/.test(line)) {\n                tabLevel -= tabDepth;\n            }\n            out.push(preIndent + tabChar.repeat(tabLevel) + line);\n            // second part of fixing UglyIf2\n            if (!uglyif2) {\n                tabLevel += tabDepth;\n            } else {\n                uglyif2 = false;\n            }\n        } else if (/^\\}$/.test(line)) {\n            tabLevel -= tabDepth;\n            if (tabLevel < 0) {\n                tabLevel = 0;\n                preIndent = preIndent.substr(tabDepth, preIndent.length - tabDepth);\n            }\n            out.push(preIndent + tabChar.repeat(tabLevel) + line);\n        } else if (!continuation && /^\\}[^\\{]+\\{[^\\}]+\\}\\s*\\{[^\\}]+\\}$/.test(line)) {\n            // this is a specific patch for UglyIf\n            tabLevel -= tabDepth;\n            if (tabLevel < 0) {\n                tabLevel = 0;\n                preIndent = preIndent.substr(tabDepth, preIndent.length - tabDepth);\n            }\n            out.push(preIndent + tabChar.repeat(tabLevel) + line);\n        } else if (!continuation && /^\\}[^\\]]+\\]$/.test(line)) {\n            // this is a specific patch for UglyStringMap\n            tabLevel -= tabDepth;\n            if (tabLevel < 0) {\n                tabLevel = 0;\n                preIndent = preIndent.substr(tabDepth, preIndent.length - tabDepth);\n            }\n            out.push(preIndent + tabChar.repeat(tabLevel) + line);\n        } else if (!continuation && /\\w+\\s+\\{[^\\{\\}]+$/.test(line)) {\n            // this is a specific patch for UglyIf2\n            out.push(preIndent + tabChar.repeat(tabLevel) + line);\n            tabLevel += tabDepth;\n            uglyif2 = true;\n        } else if (!continuation && /\\\\$/.test(line)) {\n            out.push(preIndent + tabChar.repeat(tabLevel) + line);\n            tabLevel += tabDepth;\n            continuation = true;\n        } else if (continuation && /\\{\\s+\\\\$/.test(line)) {\n            out.push(preIndent + tabChar.repeat(tabLevel) + line);\n            tabLevel += tabDepth;\n        } else if (continuation && /\\[[^\\t {\\[[\"()\\]}]+\\s+\\\\$/.test(line)) {\n            out.push(preIndent + tabChar.repeat(tabLevel) + line);\n            tabLevel += tabDepth;\n        } else if (continuation && /^\\\\?[\\]})]\\s*\\\\$/.test(line)) {\n            tabLevel -= tabDepth;\n            if (tabLevel < 0) {\n                tabLevel = 0;\n                preIndent = preIndent.substr(tabDepth, preIndent.length - tabDepth);\n            }\n            out.push(preIndent + tabChar.repeat(tabLevel) + line);\n        } else if (continuation && (/^\\\\?[\\]})\"]$/.test(line))) {\n            tabLevel -= tabDepth;\n            if (tabLevel < 0) {\n                tabLevel = 0;\n                preIndent = preIndent.substr(tabDepth, preIndent.length - tabDepth);\n            }\n            out.push(preIndent + tabChar.repeat(tabLevel) + line);\n            tabLevel -= tabDepth;\n            continuation = false;\n        } else if (continuation && (/\\\\?[\\]})\"]$/.test(line))) {\n            out.push(preIndent + tabChar.repeat(tabLevel) + line);\n            tabLevel -= tabDepth;\n            continuation = false;\n        } else if (continuation && /\\\\$/.test(line)) {\n            out.push(preIndent + tabChar.repeat(tabLevel) + line);\n        } else if (continuation && !(/\\\\$/.test(line))) {\n            out.push(preIndent + tabChar.repeat(tabLevel) + line);\n            tabLevel -= tabDepth;\n            continuation = false;\n        } else {\n            out.push(preIndent + tabChar.repeat(tabLevel) + line);\n        }\n        if (tabLevel < 0) {\n            tabLevel = 0;\n            preIndent = preIndent.substr(tabDepth, preIndent.length - tabDepth);\n        }\n    });\n    return out.join('\\n');\n}","module.exports = require(\"vscode\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","\"use strict\";\nimport * as vscode from \"vscode\";\nimport * as dochelp from \"./documentHelpers\";\nimport * as format from \"./formatProvider\";\n\nexport function activate(context: vscode.ExtensionContext) {\n    vscode.languages.registerDocumentFormattingEditProvider(\"tcl\", {\n        provideDocumentFormattingEdits(\n            document: vscode.TextDocument,\n            options: vscode.FormattingOptions\n        ): vscode.TextEdit[] {\n            const {\n                tc,\n                td,\n                ts\n            }: {\n                tc: string;\n                td: number;\n                ts: number;\n            } = dochelp.getIndentationStyle(options);\n\n            const editor = vscode.window.activeTextEditor;\n            if (!editor) {\n                return []; // No open text editor\n            }\n            return [\n                vscode.TextEdit.replace(\n                    dochelp.fullDocumentRange(document),\n                    format.formatTcl(document.getText(), \"\", tc, td)\n                )\n            ];\n        }\n    });\n\n    vscode.languages.registerDocumentRangeFormattingEditProvider(\"tcl\", {\n        provideDocumentRangeFormattingEdits(\n            document: vscode.TextDocument,\n            range: vscode.Range,\n            options: vscode.FormattingOptions\n        ): vscode.TextEdit[] {\n            const {\n                tc,\n                td,\n                ts\n            }: {\n                tc: string;\n                td: number;\n                ts: number;\n            } = dochelp.getIndentationStyle(options);\n\n            const editor = vscode.window.activeTextEditor;\n            if (!editor) {\n                return []; // No open text editor\n            }\n\n            let preIndent = \"\";\n            let priorLine = dochelp.getPreviousLineContaintingText(\n                document,\n                range\n            );\n            if (priorLine !== undefined) {\n                preIndent = format.guessPreIndentation(priorLine, tc, td, ts);\n            }\n            let selectedLines = dochelp.getSelectedLines(document, range);\n            return [\n                vscode.TextEdit.replace(\n                    selectedLines,\n                    format.formatTcl(\n                        document.getText(selectedLines),\n                        preIndent,\n                        tc,\n                        td\n                    )\n                )\n            ];\n        }\n    });\n\n    context.subscriptions.push(vscode.commands.registerCommand(\"tcl.escapeToQuotedTcl\", _ => {\n        const editor = vscode.window.activeTextEditor;\n        if (!editor) {\n            return; // No open text editor\n        }\n\n        const selections: vscode.Selection[] = [...editor.selections];\n\n        editor.edit(builder => {\n            for (const selection of selections) {\n                builder.replace(selection, format.escapeToQuotedTcl(editor.document.getText(selection)));\n            }\n        });\n    }));\n}\n\n// this method is called when your extension is deactivated\nexport function deactivate() { }\n"],"names":["document","lastLineId","lineCount","vscode","Range","lineAt","text","length","options","tc","td","insertSpaces","tabSize","ts","range","start","line","end","selectedLines","priorLineNum","priorLine","trim","input","replace","tabChar","tabDepth","whiteSpace","substr","firstNonWhitespaceCharacterIndex","preIndent","preIndentRemainder","Math","floor","repeat","RegExp","test","inputCode","tabLevel","out","continuation","uglyif2","split","forEach","element","push","join","module","exports","require","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","context","languages","registerDocumentFormattingEditProvider","provideDocumentFormattingEdits","dochelp","getIndentationStyle","window","activeTextEditor","TextEdit","fullDocumentRange","format","formatTcl","getText","registerDocumentRangeFormattingEditProvider","provideDocumentRangeFormattingEdits","getPreviousLineContaintingText","guessPreIndentation","getSelectedLines","subscriptions","commands","registerCommand","_","editor","selections","edit","builder","selection","escapeToQuotedTcl"],"sourceRoot":""}